<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–û–ø—Ä–æ—Å –î–ù–ü "–ö–ª–µ–π–º—ë–Ω–æ–≤–æ-2"</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    {% include 'analytics.html' %}
    
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            margin: 0;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 0 24px 0;
            text-align: center;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            position: relative;
        }
        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.18);
        }
        header p {
            font-size: 1.2em;
            opacity: 0.93;
            margin-bottom: 20px;
        }
        .progress-container {
            max-width: 100%;
            margin: 0 auto;
            padding: 0 20px;
        }
        .progress-bar {
            height: 9px;
            background: rgba(255,255,255,0.3);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        .progress-bar-fill {
            height: 100%;
            background: #27ae60;
            border-radius: 3px;
            width: 50%;
            transition: width 0.5s ease;
            box-shadow: 0 0 10px rgba(39,174,96,0.3);
        }
        .progress-text {
            font-size: 0.9em;
            opacity: 0.95;
            text-align: center;
        }
        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.10);
            border: 1px solid #e1e5e9;
        }
        .card h2 {
            color: #2c3e50;
            font-size: 1.8em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #3498db;
        }
        .situation-card {
            border-left: 5px solid #e74c3c;
        }
        .legal-card {
            border-left: 5px solid #f39c12;
        }
        .negative-card {
            border-left: 5px solid #c0392b;
        }
        .survey-card {
            border-left: 5px solid #27ae60;
            background: linear-gradient(135deg, #f8ffff 0%, #f0fff4 100%);
        }
        ul {
            margin: 15px 0;
            padding-left: 25px;
        }
        li {
            margin-bottom: 10px;
            line-height: 1.8;
        }
        .highlight {
            background: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #ffc107;
            margin: 20px 0;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }
        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            font-family: inherit;
            box-sizing: border-box;
            background: #fff;
        }
        select {
            min-width: 0;
            font-size: 16px;
            padding: 12px 40px 12px 15px;
            border-radius: 8px;
            border: 2px solid #e1e5e9;
            background: #fff;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg fill="gray" height="18" viewBox="0 0 24 24" width="18" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 18px 18px;
        }
        input:focus, select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.1);
        }
        .input-error {
            border-color: #e74c3c !important;
            box-shadow: 0 0 0 3px rgba(231,76,60,0.12) !important;
        }
        .input-success {
            border-color: #27ae60 !important;
            box-shadow: 0 0 0 3px rgba(39,174,96,0.13) !important;
        }
        .radio-group {
            display: flex;
            gap: 32px;
            margin: 0;
            padding: 0;
            align-items: center;
        }
        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 0;
            padding: 0;
        }
        .radio-option input[type="radio"] {
            margin: 0;
            padding: 0;
            width: 15px;
            height: 15px;
            display: inline-block;
            vertical-align: middle;
        }
        .btn {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39,174,96,0.3);
        }
        .footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 0.9em;
        }
        @media (max-width: 768px) {
            .container { padding: 10px; }
            header h1 { font-size: 2em; }
            .card { padding: 20px; }
        }
        .consent-row {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        .consent-row input[type="checkbox"] {
            width: auto;
            margin: 0;
            padding: 0;
        }
        .consent-row label {
            display: inline;
            margin-bottom: 0;
            margin-left: 12px;
            flex: 1;
        }
        .stats-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 8px 16px;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 20px;
            text-decoration: none;
            font-size: 0.9em;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .stats-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        .card-red-bg {
            background: #fff6f7;
        }
        .card-yellow-bg {
            background: #fffbe9;
        }
        .card-blue-bg {
            background: #f4f8ff;
        }
        .card-green-bg {
            background: #f4fff7;
        }
        .card-purple-bg {
            background: #faf6ff;
        }
        .answers-box {
            background: #fff;
            border-radius: 10px;
            padding: 18px 20px 12px 20px;
            margin-top: 10px;
            margin-bottom: 10px;
            box-shadow: 0 2px 8px rgba(44,62,80,0.04);
            border: 1px solid #e1e5e9;
        }
        
        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ */
        .modal {
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            backdrop-filter: blur(3px);
        }
        
        .modal-content {
            background-color: #fff;
            margin: 10% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            position: relative;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            animation: modalSlideIn 0.3s ease-out;
        }
        
        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            right: 20px;
            top: 20px;
        }
        
        .close:hover {
            color: #333;
        }
        
        .code-input-container {
            margin: 25px 0;
            text-align: center;
        }
        
        #codeInput {
            font-size: 24px;
            text-align: center;
            letter-spacing: 8px;
            font-weight: bold;
            width: 200px;
            padding: 15px;
            border: 3px solid #e1e5e9;
            border-radius: 10px;
            background: #f8f9fa;
        }
        
        #codeInput:focus {
            border-color: #3498db;
            background: white;
            outline: none;
            box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
        }
        
        .modal-buttons {
            display: flex;
            gap: 15px;
            margin-top: 25px;
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-secondary:hover {
            background: #545b62;
        }
        
        .btn-secondary:disabled {
            background: #e9ecef;
            color: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>–î–ù–ü "–ö–ª–µ–π–º—ë–Ω–æ–≤–æ-2"</h1>
            <p>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏ –∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –°–ù–¢</p>
            
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-bar-fill"></div>
                </div>
                <div class="progress-text">–®–∞–≥ 1 –∏–∑ 2: –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é</div>
            </div>
            <a href="/stats" class="stats-btn">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</a>
        </header>

        <div class="card card-yellow-bg" style="border-left: 5px solid #ffe58f;">
            <div class="answers-box">
                <h2>
                    <span style="font-size:1.3em; margin-right:8px;">üìù</span>
                    <strong>–û–ø—Ä–æ—Å –∂–∏—Ç–µ–ª–µ–π –æ –±—É–¥—É—â–µ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ—Å—ë–ª–∫–æ–º</strong>
                </h2>
                <ul>
                    <li>–≠—Ç–æ –æ–ø—Ä–æ—Å –¥–ª—è –≤—ã—è—Å–Ω–µ–Ω–∏—è –º–Ω–µ–Ω–∏—è –∂–∏—Ç–µ–ª–µ–π –æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–≥–æ –ª–∏—Ü–∞ (–°–ù–¢) –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞—à–∏–º –ø–æ—Å—ë–ª–∫–æ–º.</li>
                    <li>–í –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –î–ù–ü "–ö–ª–µ–π–º—ë–Ω–æ–≤–æ-2" –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ —Å—Ç–∞–¥–∏–∏ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏, –∏ –ø–æ —Ñ–∞–∫—Ç—É –Ω–∏–∫—Ç–æ –Ω–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Ç–µ—Ä–µ—Å—ã –ø–æ—Å—ë–ª–∫–∞.</li>
                    <li>–ù–∏–∂–µ –ø—Ä–∏–≤–µ–¥–µ–Ω—ã —Ñ–∞–∫—Ç—ã –∏ –¥–∞–Ω–Ω—ã–µ –æ —Ö–æ–¥–µ –ª–∏–∫–≤–∏–¥–∞—Ü–∏–∏.</li>
                    <li>–ü—Ä–æ—Å–∏–º –ø—Ä–æ–π—Ç–∏ –æ–ø—Ä–æ—Å, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å ‚Äî –Ω—É–∂–Ω–æ –ª–∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤–æ–µ –°–ù–¢ –∏–ª–∏ –æ—Å—Ç–∞–≤–∏—Ç—å –≤—Å—ë –∫–∞–∫ –µ—Å—Ç—å.</li>
                </ul>
                <div class="highlight" style="background: #fffbe6; border-left: 4px solid #ffe58f; margin-top: 18px;">
                    <strong>–í–∞–∂–Ω–æ–µ:</strong> —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –°–ù–¢ ‚Äî —ç—Ç–æ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ, –∞ —Ç–æ–ª—å–∫–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å. –ï—Å–ª–∏ –°–ù–¢ –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å, —Å—Ç–∞—Ä—ã–π –î–ù–ü –±—É–¥–µ—Ç –ª–∏–∫–≤–∏–¥–∏—Ä–æ–≤–∞–Ω, –∏ –≤–æ–∑–º–æ–∂–Ω—ã —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, —É–±–µ—Ä—É—Ç —Å—É–±—Å–∏–¥–∏—é –Ω–∞ —Å–≤–µ—Ç).
                </div>
            </div>
        </div>
        <div class="card card-red-bg situation-card" style="border-left: 5px solid #e74c3c;">
            <div class="answers-box">
                <h2>üö® –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è</h2>
                <ul>
                    <li><strong>–î–∞—á–Ω–æ–µ –Ω–µ–∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –ø–∞—Ä—Ç–Ω—ë—Ä—Å—Ç–≤–æ "–ö–ª–µ–π–º—ë–Ω–æ–≤–æ-2"</strong> (–û–ì–†–ù 1085043000624) –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ 08.02.2008.</li>
                    <li>–ê–¥—Ä–µ—Å: 142204, –ú–æ—Å–∫–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å, –≥. –°–µ—Ä–ø—É—Ö–æ–≤, —É–ª. –ö—Ä—é–∫–æ–≤–∞, –¥.10.</li>
                    <li>–í 2022 –≥–æ–¥—É –≤ –ï–ì–†–Æ–õ –≤–Ω–µ—Å–µ–Ω—ã —Å–≤–µ–¥–µ–Ω–∏—è –æ –Ω–µ–¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö –æ —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–º –ª–∏—Ü–µ.</li>
                    <li>07.04.2025 –Ω–∞–ª–æ–≥–æ–≤—ã–º –æ—Ä–≥–∞–Ω–æ–º –ø—Ä–∏–Ω—è—Ç–æ —Ä–µ—à–µ–Ω–∏–µ –æ –ø—Ä–µ–¥—Å—Ç–æ—è—â–µ–º –∏—Å–∫–ª—é—á–µ–Ω–∏–∏ –î–ù–ü "–ö–ª–µ–π–º—ë–Ω–æ–≤–æ-2" –∏–∑ –ï–ì–†–Æ–õ (—Ä–µ—à–µ–Ω–∏–µ ‚Ññ6336).</li>
                    <li>–†–µ—à–µ–Ω–∏–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ –≤ "–í–µ—Å—Ç–Ω–∏–∫–µ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏" ‚Ññ14 –æ—Ç 09.04.2025.</li>
                    <li>–ü–æ—Å–ª–µ–¥–Ω–∏–π –ø—Ä–µ–¥—Å–µ–¥–∞—Ç–µ–ª—å: –í–∞—Å–∏–ª—å–µ–≤ –ê–Ω–¥—Ä–µ–π –ì–µ–Ω–Ω–∞–¥—å–µ–≤–∏—á (–Ω–∞–∑–Ω–∞—á–µ–Ω 07.04.2018).</li>
                </ul>
            </div>
        </div>
        <div class="card card-yellow-bg legal-card" style="border-left: 5px solid #f39c12;">
            <div class="answers-box">
                <h2>‚öñÔ∏è –ü—Ä–∞–≤–æ–≤–∞—è –±–∞–∑–∞</h2>
                <ul>
                    <li>–ò—Å–∫–ª—é—á–µ–Ω–∏–µ —é—Ä–∏–¥–∏—á–µ—Å–∫–æ–≥–æ –ª–∏—Ü–∞ –∏–∑ –ï–ì–†–Æ–õ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–∞–Ω–∏–∏ —Å—Ç. 21.1 –§–µ–¥–µ—Ä–∞–ª—å–Ω–æ–≥–æ –∑–∞–∫–æ–Ω–∞ ‚Ññ129-–§–ó "–û –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω–æ–π —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —é—Ä–∏–¥–∏—á–µ—Å–∫–∏—Ö –ª–∏—Ü –∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã—Ö –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª–µ–π".</li>
                    <li>–ü—Ä–∏—á–∏–Ω–∞ ‚Äî –Ω–∞–ª–∏—á–∏–µ –≤ –ï–ì–†–Æ–õ —Å–≤–µ–¥–µ–Ω–∏–π –æ –Ω–µ–¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö.</li>
                    <li>–í—Å–µ —Å–≤–µ–¥–µ–Ω–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã –≤—ã–ø–∏—Å–∫–æ–π –∏–∑ –ï–ì–†–Æ–õ –æ—Ç 03.06.2025 (<a href="/static/–ï–ì–†–Æ–õ_–≤—ã–ø–∏—Å–∫–∞.pdf" target="_blank">PDF</a>).</li>
                </ul>
            </div>
        </div>
        <div class="card card-green-bg positive-card" style="border-left: 5px solid #27ae60;">
            <div class="answers-box">
                <h2>üå± –ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ –°–ù–¢</h2>
                <ul>
                    <li><strong>–ü–æ—è–≤–∏—Ç—Å—è –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—å</strong> (–ø—Ä–µ–¥—Å–µ–¥–∞—Ç–µ–ª—å), –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∑–∞—â–∏—â–∞—Ç—å –∏–Ω—Ç–µ—Ä–µ—Å—ã –∂–∏—Ç–µ–ª–µ–π.</li>
                    <li><strong>–ü—Ä–æ–∑—Ä–∞—á–Ω–∞—è –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è –∏ –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç—å</strong> ‚Äî –≤—Å–µ —Ä–∞—Å—Ö–æ–¥—ã –∏ –¥–æ—Ö–æ–¥—ã –±—É–¥—É—Ç —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å—Å—è –∏ –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏.</li>
                    <li><strong>–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –ø–ª–∞—Ç–µ–∂–µ–π</strong> (—á–µ—Ä–µ–∑ —Å–∞–π—Ç, –±–æ—Ç–∞, –±–∞–Ω–∫–æ–≤—Å–∫–∏–µ —Å–µ—Ä–≤–∏—Å—ã).</li>
                    <li><strong>–û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –±–ª–∞–≥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏</strong> (–¥–æ—Ä–æ–≥–∏, –æ—Å–≤–µ—â–µ–Ω–∏–µ, –æ–∑–µ–ª–µ–Ω–µ–Ω–∏–µ, —É–±–æ—Ä–∫–∞).</li>
                    <li><strong>–ü–æ–≤—ã—à–µ–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —É—á–∞—Å—Ç–∫–æ–≤</strong> –∑–∞ —Å—á—ë—Ç –ø–æ—Ä—è–¥–∫–∞ –∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã.</li>
                    <li><strong>–ö–æ–ª–ª–µ–∫—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–æ–≤</strong> (–≥–∞–∑, –≤–æ–¥–∞, –∏–Ω—Ç–µ—Ä–Ω–µ—Ç, –æ—Ö—Ä–∞–Ω–∞, –º—É—Å–æ—Ä).</li>
                    <li><strong>–õ–µ–≥–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å</strong> –¥–ª—è –∑–∞–∫–ª—é—á–µ–Ω–∏—è –¥–æ–≥–æ–≤–æ—Ä–æ–≤ —Å –ø–æ–¥—Ä—è–¥—á–∏–∫–∞–º–∏ –∏ –∫–æ–º–º—É–Ω–∞–ª—å–Ω—ã–º–∏ —Å–ª—É–∂–±–∞–º–∏.</li>
                    <li><strong>–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–ª—É—á–∞—Ç—å —Å—É–±—Å–∏–¥–∏–∏ –∏ —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ –≥–æ—Å–ø—Ä–æ–≥—Ä–∞–º–º–∞—Ö.</strong></li>
                    <li><strong>–£–ø—Ä–æ—â–µ–Ω–∏–µ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ –º–µ–∂–¥—É –∂–∏—Ç–µ–ª—è–º–∏</strong> (—á–∞—Ç, —Å–∞–π—Ç, —Ä–∞—Å—Å—ã–ª–∫–∏).</li>
                    <li><strong>–ü–æ–≤—ã—à–µ–Ω–∏–µ –ø—Ä–∏–≤–ª–µ–∫–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–æ—Å—ë–ª–∫–∞</strong> –¥–ª—è –Ω–æ–≤—ã—Ö –∂–∏—Ç–µ–ª–µ–π –∏ –∏–Ω–≤–µ—Å—Ç–æ—Ä–æ–≤.</li>
                </ul>
            </div>
        </div>
        <div class="card card-red-bg negative-card" style="border-left: 5px solid #c0392b;">
            <div class="answers-box">
                <h2>‚ö†Ô∏è –í–æ–∑–º–æ–∂–Ω—ã–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –°–ù–¢</h2>
                <p>–í–∞–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å, —á—Ç–æ –Ω–æ–≤–æ–µ –°–ù–¢ –±—É–¥–µ—Ç –∏–º–µ—Ç—å –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞:</p>
                <ul>
                    <li><strong>–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞:</strong>
                        <ul>
                            <li>–ï–∂–µ–º–µ—Å—è—á–Ω—ã–µ –≤–∑–Ω–æ—Å—ã –Ω–∞ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã</li>
                            <li>–ó–∞—Ä–ø–ª–∞—Ç–∞ –ø—Ä–µ–¥—Å–µ–¥–∞—Ç–µ–ª—è –∏ –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∞</li>
                            <li>–†–∞—Å—Ö–æ–¥—ã –Ω–∞ –≤–µ–¥–µ–Ω–∏–µ –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç–∏</li>
                            <li>–ù–∞–ª–æ–≥–∏ –∏ —Å–±–æ—Ä—ã</li>
                        </ul>
                    </li>
                    <li><strong>–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞:</strong>
                        <ul>
                            <li>–í–µ–¥–µ–Ω–∏–µ —Ä–µ–µ—Å—Ç—Ä–∞ —á–ª–µ–Ω–æ–≤ –°–ù–¢</li>
                            <li>–ü–æ–¥–∞—á–∞ –æ—Ç—á—ë—Ç–æ–≤ –≤ –Ω–∞–ª–æ–≥–æ–≤—É—é –∏ –º—É–Ω–∏—Ü–∏–ø–∞–ª–∏—Ç–µ—Ç</li>
                            <li>–ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö —Å–æ–±—Ä–∞–Ω–∏–π</li>
                            <li>–î–æ–∫—É–º–µ–Ω—Ç–æ–æ–±–æ—Ä–æ—Ç –∏ –¥–µ–ª–æ–ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ</li>
                        </ul>
                    </li>
                    <li><strong>–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞:</strong>
                        <ul>
                            <li>–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –≤—ã–≤–æ–∑–∞ –º—É—Å–æ—Ä–∞ (—É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤, –¥–æ–≥–æ–≤–æ—Ä —Å —É–ø—Ä–∞–≤–ª—è—é—â–µ–π –∫–æ–º–ø–∞–Ω–∏–µ–π)</li>
                            <li>–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –¥–æ—Ä–æ–≥ –≤ –Ω–∞–¥–ª–µ–∂–∞—â–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏</li>
                            <li>–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ —ç–ª–µ–∫—Ç—Ä–æ—Å–µ—Ç–µ–π (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)</li>
                            <li>–£–±–æ—Ä–∫–∞ –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–π</li>
                        </ul>
                    </li>
                    <li><strong>–ü—Ä–∞–≤–æ–≤—ã–µ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞:</strong>
                        <ul>
                            <li>–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–∞</li>
                            <li>–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–¥ –º—É–Ω–∏—Ü–∏–ø–∞–ª–∏—Ç–µ—Ç–æ–º</li>
                            <li>–ò—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–µ–¥–ø–∏—Å–∞–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é—â–∏—Ö –æ—Ä–≥–∞–Ω–æ–≤</li>
                        </ul>
                    </li>
                </ul>
                <div class="highlight">
                    <strong>–í–∞–∂–Ω–æ:</strong> –°–µ–π—á–∞—Å, –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–µ–π—Å—Ç–≤—É—é—â–µ–≥–æ –î–ù–ü, –∂–∏—Ç–µ–ª–∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–µ –Ω–µ—Å—É—Ç –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–∞ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏, –Ω–æ –∏ –Ω–µ –º–æ–≥—É—Ç —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å –Ω–∞ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –æ–±—â–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤.
                </div>
            </div>
        </div>
        <div class="card survey-card">
            <h2>üìù –û–ø—Ä–æ—Å –∂–∏—Ç–µ–ª–µ–π</h2>
            <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –Ω–∏–∂–µ. –í–∞—à–µ –º–Ω–µ–Ω–∏–µ –≤–∞–∂–Ω–æ –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏—è –æ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –°–ù–¢.</p>
        <form id="survey-form">
                <div class="form-group">
                    <label for="fio">–§–ò–û</label>
                    <input type="text" id="fio" name="fio" required 
                           pattern="^[–ê-–Ø–∞-—è–Å—ëA-Za-z\-\s]{2,}$"
                           title="–§–ò–û –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞ (—Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã, –ø—Ä–æ–±–µ–ª—ã –∏ –¥–µ—Ñ–∏—Å—ã)">
                </div>
                <div class="form-group">
                    <label for="phone">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                    <input type="tel" id="phone" name="phone" required pattern="^\+7\s?\(\d{3}\)\s?\d{3}-\d{2}-\d{2}$" placeholder="+7 (___) ___-__-__">
                </div>
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" name="email" required>
                </div>
                <div class="form-group">
                    <label for="kadastr_select">–ö–∞–¥–∞—Å—Ç—Ä–æ–≤—ã–π –Ω–æ–º–µ—Ä —É—á–∞—Å—Ç–∫–∞</label>
                    <select id="kadastr_select" name="kadastr_select" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç</option>
                        <option value="has">–£–∫–∞–∑–∞—Ç—å –∫–∞–¥–∞—Å—Ç—Ä–æ–≤—ã–π –Ω–æ–º–µ—Ä</option>
                        <option value="none">–ù–µ—Ç –∫–∞–¥–∞—Å—Ç—Ä–æ–≤–æ–≥–æ –Ω–æ–º–µ—Ä–∞</option>
                    </select>
                    <input type="text" id="kadastr" name="kadastr" style="display:none; margin-top:10px;"
                           pattern="^\d{2}:\d{2}:\d{7}:\d{4}$"
                           placeholder="50:XX:XXXXXXX:XXXX"
                           title="–ö–∞–¥–∞—Å—Ç—Ä–æ–≤—ã–π –Ω–æ–º–µ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ XX:XX:XXXXXXX:XXXX (–≥–¥–µ X - —Ü–∏—Ñ—Ä—ã)">
                    <div class="highlight" style="margin-top:10px;">
                        –û—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –Ω–∏–∂–µ –±—É–¥—É—Ç —É—á—Ç–µ–Ω—ã —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—ã —É–∫–∞–∂–µ—Ç–µ –∫–∞–¥–∞—Å—Ç—Ä–æ–≤—ã–π –Ω–æ–º–µ—Ä. –ë–µ–∑ –∫–∞–¥–∞—Å—Ç—Ä–æ–≤–æ–≥–æ –Ω–æ–º–µ—Ä–∞ –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –≤—Ç–æ—Ä–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã.
                    </div>
                </div>
                <div class="form-group">
                    <label for="snt_support">–ì–æ—Ç–æ–≤—ã –ª–∏ –≤—ã —É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –°–ù–¢?</label>
                    <select id="snt_support" name="snt_support" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç</option>
                        <option value="–î–∞">–î–∞</option>
                        <option value="–ù–µ—Ç">–ù–µ—Ç</option>
                        <option value="–ó–∞—Ç—Ä—É–¥–Ω—è—é—Å—å">–ó–∞—Ç—Ä—É–¥–Ω—è—é—Å—å</option>
                        <option value="–û—Å—Ç–∞–≤–∏—Ç—å –≤—Å—ë –∫–∞–∫ –µ—Å—Ç—å">–û—Å—Ç–∞–≤–∏—Ç—å –≤—Å—ë –∫–∞–∫ –µ—Å—Ç—å</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="payment_ready">–ì–æ—Ç–æ–≤—ã –ª–∏ –≤—ã –∫ –µ–∂–µ–º–µ—Å—è—á–Ω—ã–º –≤–∑–Ω–æ—Å–∞–º –Ω–∞ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –°–ù–¢?</label>
                    <select id="payment_ready" name="payment_ready" required>
                        <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç</option>
                        <option value="–î–∞">–î–∞</option>
                        <option value="–ù–µ—Ç">–ù–µ—Ç</option>
                        <option value="–ó–∞–≤–∏—Å–∏—Ç –æ—Ç —Å—É–º–º—ã">–ó–∞–≤–∏—Å–∏—Ç –æ—Ç —Å—É–º–º—ã</option>
                    </select>
                </div>
                <div class="form-group">
                    <div class="consent-row">
                        <input type="checkbox" name="consent" id="consent-checkbox" required>
                        <label for="consent-checkbox">
                            –Ø –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                            (<a href="/consent" target="_blank" id="consent-link">–ø–æ–¥—Ä–æ–±–Ω–µ–µ</a>)
                        </label>
                    </div>
                </div>
                <button type="submit" class="btn">–ü–µ—Ä–µ–π—Ç–∏ –∫ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–º—É –æ–ø—Ä–æ—Å—É</button>
        </form>
        <div id="thanks" style="display:none;">
            <h2>–°–ø–∞—Å–∏–±–æ –∑–∞ —É—á–∞—Å—Ç–∏–µ!</h2>
        </div>
    </div>
        <div class="footer">
            <p>–ò–Ω–∏—Ü–∏–∞—Ç–∏–≤–Ω–∞—è –≥—Ä—É–ø–ø–∞ –∂–∏—Ç–µ–ª–µ–π –î–ù–ü "–ö–ª–µ–π–º—ë–Ω–æ–≤–æ-2" | 2025</p>
            <p>–í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ</p>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="{{ url_for('static', path='consent.js') }}"></script>
    <script>
        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–µ—Ñ–æ–Ω–∞
        document.getElementById('phone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 0) {
                if (value[0] === '8') value = '7' + value.slice(1);
                if (value[0] !== '7') value = '7' + value;
            }
            let formatted = '+7';
            if (value.length > 1) {
                formatted += ' (' + value.slice(1, 4);
                if (value.length > 4) {
                    formatted += ') ' + value.slice(4, 7);
                    if (value.length > 7) {
                        formatted += '-' + value.slice(7, 9);
                        if (value.length > 9) {
                            formatted += '-' + value.slice(9, 11);
                        }
                    }
                }
            }
            e.target.value = formatted;
        });
        // --- –ö–∞–¥–∞—Å—Ç—Ä–æ–≤—ã–π –Ω–æ–º–µ—Ä: –ª–æ–≥–∏–∫–∞ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ ---
        const kadastrSelect = document.getElementById('kadastr_select');
        const kadastrInput = document.getElementById('kadastr');
        const sntSupportGroup = document.getElementById('snt_support').closest('.form-group');
        const paymentReadyGroup = document.getElementById('payment_ready').closest('.form-group');
        kadastrSelect.addEventListener('change', function() {
            if (this.value === 'has') {
                kadastrInput.style.display = '';
                kadastrInput.required = true;
                sntSupportGroup.style.display = '';
                paymentReadyGroup.style.display = '';
            } else {
                kadastrInput.style.display = 'none';
                kadastrInput.required = false;
                kadastrInput.value = '';
                kadastrInput.classList.remove('input-error', 'input-success');
                // –°–∫—Ä—ã–≤–∞–µ–º –≤–æ–ø—Ä–æ—Å—ã –ø—Ä–æ –°–ù–¢ –∏ –≤–∑–Ω–æ—Å—ã
                sntSupportGroup.style.display = 'none';
                paymentReadyGroup.style.display = 'none';
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è
                document.getElementById('snt_support').value = '';
                document.getElementById('payment_ready').value = '';
            }
        });
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
        document.getElementById('survey-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            const form = e.target;
            const formData = new FormData(form);
            const data = {};
            for (let [key, value] of formData.entries()) {
                if (data[key]) {
                    if (Array.isArray(data[key])) {
                        data[key].push(value);
                    } else {
                        data[key] = [data[key], value];
                    }
                } else {
                    data[key] = value;
                }
            }
            // --- –ö–∞–¥–∞—Å—Ç—Ä–æ–≤—ã–π –Ω–æ–º–µ—Ä: –µ—Å–ª–∏ –Ω–µ –≤—ã–±—Ä–∞–Ω, –ø–∏—à–µ–º null ---
            if (data.kadastr_select === 'none') {
                data.kadastr = null;
            }
            
            // --- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∞–Ω–∫–µ—Ç ---
            const unfinishedRes = await fetch('/survey/check_unfinished', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    email: data.email,
                    kadastr: data.kadastr,
                    phone: data.phone
                })
            }).then(r => r.json());
            
            if (unfinishedRes.has_unfinished) {
                const continueChoice = confirm(
                    `–ù–∞–π–¥–µ–Ω–∞ –Ω–µ–∑–∞–≤–µ—Ä—à–µ–Ω–Ω–∞—è –∞–Ω–∫–µ—Ç–∞ –æ—Ç ${new Date(unfinishedRes.created_at).toLocaleString('ru-RU')}.\n\n` +
                    `–í—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –µ—ë –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ.\n\n` +
                    `–•–æ—Ç–∏—Ç–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å? –ù–∞ –≤–∞—à email –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.`
                );
                
                if (continueChoice) {
                    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–æ–¥ –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
                    showCodeModal(data.email, unfinishedRes.session_id);
                    return;
                } else {
                    // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Ö–æ—á–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å - –ø—Ä–µ—Ä—ã–≤–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å
                    alert('–î–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –æ–ø—Ä–æ—Å–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–π.');
                    return;
                }
            }
            
            // --- –ü—Ä–æ–≤–µ—Ä–∫–∞ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∞–Ω–∫–µ—Ç ---
            const checkRes = await fetch('/survey/check_unique', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    email: data.email,
                    kadastr: data.kadastr,
                    phone: data.phone
                })
            }).then(r => r.json());
            let hasError = false;
            if (checkRes.email_exists) {
                email.classList.add('input-error');
                email.classList.remove('input-success');
                hasError = true;
            }
            if (checkRes.kadastr_exists) {
                kadastr.classList.add('input-error');
                kadastr.classList.remove('input-success');
                hasError = true;
            }
            if (checkRes.phone_exists) {
                phone.classList.add('input-error');
                phone.classList.remove('input-success');
                hasError = true;
            }
            if (hasError) {
                alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ —É–∂–µ –∑–∞–ø–æ–ª–Ω—è–ª –æ–ø—Ä–æ—Å! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ email, —Ç–µ–ª–µ—Ñ–æ–Ω –∏ –∫–∞–¥–∞—Å—Ç—Ä–æ–≤—ã–π –Ω–æ–º–µ—Ä.');
                return;
            }
            // --- –ï—Å–ª–∏ –≤—Å—ë –æ–∫, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –∫–∞–∫ —Ä–∞–Ω—å—à–µ ---
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º session_id
            const session_id = crypto.randomUUID();
            data.session_id = session_id;
            // –°–æ–±–∏—Ä–∞–µ–º –æ—Ç–≤–µ—Ç—ã –¥–ª—è /survey/base
            const answers = [
                { question_id: 1, value: data.fio },
                { question_id: 3, value: data.phone },
                { question_id: 18, value: data.email },
                { question_id: 2, value: data.kadastr },
                { question_id: 4, value: data.snt_support },
                { question_id: 5, value: data.payment_ready }
            ];
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ /survey/base
            await fetch('/survey/base', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    session_id,
                    answers,
                    consent: data.consent || false,
                    screenshot: null
                })
            });
            localStorage.setItem('session_id', session_id);
            localStorage.setItem('surveyBase', JSON.stringify(data));
            localStorage.setItem('autoConsent', '1');
            let iframe = document.createElement('iframe');
            iframe.style.opacity = '0.01';
            iframe.style.position = 'fixed';
            iframe.style.left = '0';
            iframe.style.top = '0';
            iframe.style.width = '600px';
            iframe.style.height = '800px';
            iframe.style.zIndex = '9999';
            iframe.src = '/consent';
            document.body.appendChild(iframe);
            setTimeout(() => {
                document.body.removeChild(iframe);
                localStorage.removeItem('autoConsent');
                window.location.href = '/details';
            }, 2000);
        });
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ localStorage –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Å—Å—ã–ª–∫—É "–ø–æ–¥—Ä–æ–±–Ω–µ–µ"
        document.getElementById('consent-link').addEventListener('click', function() {
            const fio = document.getElementById('fio').value;
            const phone = document.getElementById('phone').value;
            const email = document.getElementById('email').value;
            const kadastr = document.getElementById('kadastr').value;
            const snt_support = document.getElementById('snt_support').value;
            const payment_ready = document.getElementById('payment_ready').value;
            localStorage.setItem('surveyBase', JSON.stringify({ fio, phone, email, kadastr, snt_support, payment_ready, consent }));
        });
        const consentCheckbox = document.querySelector('input[name="consent"]');
        if (consentCheckbox) {
            consentCheckbox.addEventListener('change', function() {
                const fio = document.getElementById('fio').value;
                const phone = document.getElementById('phone').value;
                const email = document.getElementById('email').value;
                const kadastr = document.getElementById('kadastr').value;
                const snt_support = document.getElementById('snt_support').value;
                const payment_ready = document.getElementById('payment_ready').value;
                const consent = consentCheckbox.checked;
                localStorage.setItem('surveyBase', JSON.stringify({ fio, phone, email, kadastr, snt_support, payment_ready, consent }));
            });
        }
        // --- –í–ê–õ–ò–î–ê–¶–ò–Ø ---
        function validateFio(fio) {
            return /^[–ê-–Ø–∞-—è–Å—ëA-Za-z\-\s]{2,}$/.test(fio.trim());
        }
        function validatePhone(phone) {
            return /^\+7 \(\d{3}\) \d{3}-\d{2}-\d{2}$/.test(phone.trim());
        }
        function validateEmail(email) {
            return /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(email.trim());
        }
        function validateKadastr(kadastr) {
            return /^\d{2}:\d{2}:\d{7}:\d{4}$/.test(kadastr.trim());
        }
        function setValidationClass(input, valid) {
            input.classList.remove('input-error', 'input-success');
            if (input.value === '') return;
            if (valid) {
                input.classList.add('input-success');
            } else {
                input.classList.add('input-error');
            }
        }
        const fio = document.getElementById('fio');
        const phone = document.getElementById('phone');
        const email = document.getElementById('email');
        const kadastr = document.getElementById('kadastr');
        fio.addEventListener('input', function() {
            setValidationClass(this, validateFio(this.value));
        });
        phone.addEventListener('input', function() {
            setValidationClass(this, validatePhone(this.value));
        });
        email.addEventListener('input', function() {
            setValidationClass(this, validateEmail(this.value));
        });
        kadastr.addEventListener('input', function() {
            setValidationClass(this, validateKadastr(this.value));
        });
        fio.addEventListener('blur', function() {
            setValidationClass(this, validateFio(this.value));
        });
        phone.addEventListener('blur', function() {
            setValidationClass(this, validatePhone(this.value));
        });
        email.addEventListener('blur', function() {
            setValidationClass(this, validateEmail(this.value));
        });
        kadastr.addEventListener('blur', function() {
            setValidationClass(this, validateKadastr(this.value));
        });
        
        // ===== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –†–ê–ë–û–¢–´ –° –ú–û–î–ê–õ–¨–ù–´–ú –û–ö–ù–û–ú =====
        
        let currentEmail = '';
        let currentSessionId = '';
        let resendTimer = null;
        
        function showCodeModal(email, sessionId) {
            currentEmail = email;
            currentSessionId = sessionId;
            
            const modal = document.getElementById('codeModal');
            const codeInput = document.getElementById('codeInput');
            const errorDiv = document.getElementById('codeError');
            
            // –û—á–∏—â–∞–µ–º —Ñ–æ—Ä–º—É
            codeInput.value = '';
            errorDiv.style.display = 'none';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            modal.style.display = 'block';
            
            // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
            setTimeout(() => codeInput.focus(), 100);
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–æ–¥
            sendVerificationCode(email, sessionId);
        }
        
        function hideCodeModal() {
            const modal = document.getElementById('codeModal');
            modal.style.display = 'none';
            if (resendTimer) {
                clearInterval(resendTimer);
                resendTimer = null;
            }
        }
        
        async function sendVerificationCode(email, sessionId) {
            const resendBtn = document.getElementById('resendCodeBtn');
            const resendTimer = document.getElementById('resendTimer');
            
            try {
                const response = await fetch('/survey/send_code', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, session_id: sessionId })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage('–ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –≤–∞—à—É –ø–æ—á—Ç—É');
                    startResendTimer(120); // 2 –º–∏–Ω—É—Ç—ã
                } else {
                    showError(result.message);
                    if (result.seconds_until_new_request > 0) {
                        startResendTimer(result.seconds_until_new_request);
                    }
                }
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∫–æ–¥–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
            }
        }
        
        async function verifyCode() {
            const codeInput = document.getElementById('codeInput');
            const code = codeInput.value.trim();
            
            if (code.length !== 6) {
                showError('–í–≤–µ–¥–∏—Ç–µ 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥');
                return;
            }
            
            const verifyBtn = document.getElementById('verifyCodeBtn');
            const originalText = verifyBtn.textContent;
            verifyBtn.textContent = '–ü—Ä–æ–≤–µ—Ä—è–µ–º...';
            verifyBtn.disabled = true;
            
            try {
                const response = await fetch('/survey/verify_code', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: currentEmail,
                        code: code,
                        session_id: currentSessionId
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showMessage('–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω! –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –∞–Ω–∫–µ—Ç–µ...');
                    // –°–æ—Ö—Ä–∞–Ω—è–µ–º session_id –∏ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ details
                    localStorage.setItem('session_id', currentSessionId);
                    setTimeout(() => {
                        hideCodeModal();
                        window.location.href = '/details';
                    }, 1500);
                } else {
                    showError(result.message);
                }
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–¥–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
            } finally {
                verifyBtn.textContent = originalText;
                verifyBtn.disabled = false;
            }
        }
        
        function startResendTimer(seconds) {
            const resendBtn = document.getElementById('resendCodeBtn');
            const timerSpan = document.getElementById('resendTimer');
            
            resendBtn.disabled = true;
            let remaining = seconds;
            
            function updateTimer() {
                const minutes = Math.floor(remaining / 60);
                const secs = remaining % 60;
                timerSpan.textContent = `(${minutes}:${secs.toString().padStart(2, '0')})`;
                
                if (remaining <= 0) {
                    resendBtn.disabled = false;
                    timerSpan.textContent = '';
                    clearInterval(resendTimer);
                    resendTimer = null;
                } else {
                    remaining--;
                }
            }
            
            updateTimer();
            resendTimer = setInterval(updateTimer, 1000);
        }
        
        function showMessage(message) {
            const messageP = document.getElementById('codeModalMessage');
            messageP.textContent = message;
            messageP.style.color = '#27ae60';
        }
        
        function showError(message) {
            const errorDiv = document.getElementById('codeError');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        document.addEventListener('DOMContentLoaded', function() {
            const modal = document.getElementById('codeModal');
            const closeBtn = modal.querySelector('.close');
            const verifyBtn = document.getElementById('verifyCodeBtn');
            const resendBtn = document.getElementById('resendCodeBtn');
            const codeInput = document.getElementById('codeInput');
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            closeBtn.addEventListener('click', hideCodeModal);
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            window.addEventListener('click', function(event) {
                if (event.target === modal) {
                    hideCodeModal();
                }
            });
            
            // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∫–æ–¥–∞
            verifyBtn.addEventListener('click', verifyCode);
            
            // –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–¥–∞
            resendBtn.addEventListener('click', function() {
                if (!this.disabled) {
                    sendVerificationCode(currentEmail, currentSessionId);
                }
            });
            
            // –í–≤–æ–¥ —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä –≤ –ø–æ–ª–µ –∫–æ–¥–∞
            codeInput.addEventListener('input', function(e) {
                e.target.value = e.target.value.replace(/[^0-9]/g, '');
            });
            
            // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ Enter
            codeInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    verifyCode();
                }
            });
        });
    </script>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –≤–≤–æ–¥–∞ –∫–æ–¥–∞ -->
    <div id="codeModal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</h2>
            <p id="codeModalMessage">–ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –≤–∞—à—É –ø–æ—á—Ç—É. –í–≤–µ–¥–∏—Ç–µ –µ–≥–æ –Ω–∏–∂–µ:</p>
            
            <div class="code-input-container">
                <input type="text" id="codeInput" maxlength="6" placeholder="000000" 
                       pattern="[0-9]{6}" autocomplete="off">
            </div>
            
            <div class="modal-buttons">
                <button id="verifyCodeBtn" class="btn">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
                <button id="resendCodeBtn" class="btn btn-secondary" disabled>
                    –û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –∫–æ–¥ <span id="resendTimer"></span>
                </button>
            </div>
            
            <div id="codeError" class="error-message" style="display: none;"></div>
        </div>
    </div>
    
</body>
</html>